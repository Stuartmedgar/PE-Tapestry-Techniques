<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PE Formative Assessment - 40 Techniques</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        .container { max-width: 800px; margin: 0 auto; }
        header {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 { color: #667eea; margin-bottom: 10px; font-size: 1.8em; }
        .subtitle { color: #666; font-size: 0.95em; margin-bottom: 15px; }
        .search-box {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        .search-box:focus { outline: none; border-color: #667eea; }
        .filter-buttons { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        .filter-btn.active { background: #667eea; color: white; }
        .stats-bar {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .stat-number { font-size: 1.5em; font-weight: bold; color: #667eea; }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        .btn-primary { background: #667eea; color: white; }
        .btn-secondary { background: #e0e0e0; color: #666; }
        .btn-success { background: #2ecc71; color: white; }
        .btn-danger { background: #ff4757; color: white; }
        .btn-small { padding: 5px 10px; font-size: 12px; }
        .technique-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            transition: transform 0.2s;
        }
        .technique-card:hover { transform: translateY(-2px); }
        .technique-card.favorite { border: 3px solid #ffd700; background: #fffef0; }
        .technique-card.expanded { background: #f8f9ff; }
        .technique-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .technique-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }
        .action-buttons { display: flex; gap: 8px; align-items: center; }
        .icon-btn {
            background: none;
            border: none;
            font-size: 1.3em;
            cursor: pointer;
            padding: 5px;
        }
        .favorite-btn { color: #ffd700; }
        .edit-btn { color: #667eea; }
        .delete-btn { color: #ff4757; }
        .expand-icon {
            color: #667eea;
            font-size: 1.5em;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .technique-card.expanded .expand-icon { transform: rotate(180deg); }
        .technique-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .technique-description {
            color: #666;
            line-height: 1.5;
            cursor: pointer;
        }
        .examples-section {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e0e0e0;
        }
        .examples-section.show { display: block; }
        .examples-title {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 12px;
        }
        .example {
            background: white;
            padding: 12px;
            padding-right: 70px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            line-height: 1.6;
            position: relative;
        }
        .example-number {
            font-weight: 600;
            color: #667eea;
            margin-right: 5px;
        }
        .example-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 5px;
        }
        .example-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            padding: 2px 5px;
            opacity: 0.6;
        }
        .example-btn:hover { opacity: 1; }
        .add-technique-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #2ecc71;
            color: white;
            border: none;
            font-size: 2em;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 100;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-content h2 {
            color: #667eea;
            margin-bottom: 20px;
        }
        .form-group { margin-bottom: 15px; }
        .form-group label {
            display: block;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .examples-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .example-input-row {
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }
        .example-input-row textarea { flex: 1; }
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            padding: 20px;
            font-size: 0.9em;
        }
        @media (max-width: 600px) {
            body { padding: 10px; }
            h1 { font-size: 1.5em; }
            .add-technique-btn { bottom: 20px; right: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèÉ‚Äç‚ôÇÔ∏è PE Formative Assessment</h1>
            <p class="subtitle">40 techniques from Dylan Wiliam's "Embedded Formative Assessment"</p>
            
            <input type="text" class="search-box" id="searchBox" placeholder="Search techniques...">
            
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="setFilter('all')">All Techniques</button>
                <button class="filter-btn" onclick="setFilter('favorites')">‚≠ê Favorites</button>
            </div>
            
            <div class="stats-bar">
                <div>
                    <span class="stat-number" id="favoriteCount">0</span>
                    <span style="color: #666; font-size: 0.9em;"> favorites</span>
                </div>
                <div>
                    <button class="btn btn-primary" onclick="shareList()">üì§ Share</button>
                    <button class="btn btn-secondary" onclick="exportData()">üíæ Export</button>
                    <button class="btn btn-secondary" onclick="importData()">üì• Import</button>
                </div>
            </div>
        </header>
        
        <div id="techniquesGrid"></div>
        
        <button class="add-technique-btn" onclick="showAddModal()" title="Add New Technique">+</button>
        
        <div class="footer">
            Based on Dylan Wiliam's "Embedded Formative Assessment"<br>
            ‚≠ê Mark favorites (appear at top) ‚Ä¢ ‚úèÔ∏è Edit ‚Ä¢ üóëÔ∏è Delete ‚Ä¢ ‚ûï Add New<br>
            <small>üíæ Works 100% offline - All data saved locally in your browser</small>
        </div>
    </div>

    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h2>Confirm Action</h2>
            <p id="confirmMessage"></p>
            <div class="modal-buttons">
                <button class="btn btn-danger" onclick="confirmAction()">Confirm</button>
                <button class="btn btn-secondary" onclick="hideConfirmModal()">Cancel</button>
            </div>
        </div>
    </div>

    <div class="modal" id="editModal">
        <div class="modal-content">
            <h2 id="editModalTitle">Edit Technique</h2>
            <div class="form-group">
                <label>Technique Title *</label>
                <input type="text" id="editTitle">
            </div>
            <div class="form-group">
                <label>Description *</label>
                <textarea id="editDescription"></textarea>
            </div>
            <div class="form-group">
                <label>Examples (at least one required)</label>
                <div class="examples-inputs" id="examplesContainer"></div>
                <button class="btn btn-secondary btn-small" onclick="addExampleField()" style="margin-top: 10px;">+ Add Example</button>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" onclick="saveTechnique()">Save</button>
                <button class="btn btn-secondary" onclick="hideEditModal()">Cancel</button>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" accept=".json" style="display: none;">

    <script>
        var DEFAULT_TECHNIQUES = [
            {id:1,title:"Traffic Lights",description:"Students show red/yellow/green cards to indicate understanding or confidence level",examples:["During basketball dribbling practice, students hold up green (confident with weak hand), yellow (need more practice), or red (struggling with technique)","In gymnastics, after learning a new balance, students show their card to indicate if they can hold it for 5 seconds (green), 3 seconds (yellow), or less than 3 seconds (red)","During fitness testing, students use traffic lights to show if they met their target heart rate zone (green), came close (yellow), or missed it (red)"]},
            {id:2,title:"Two Stars and a Wish",description:"Feedback format: two things done well, one area for improvement",examples:["After watching a gymnastics routine: 'Your landing was stable and your arms were straight. I wish you'd point your toes throughout.'","Observing a tennis serve: 'Your ball toss was consistent and you had great follow-through. I wish you'd bend your knees more for extra power.'","Watching a swimming stroke: 'Your breathing timing was perfect and your kicks were strong. I wish you'd extend your arm further on the reach.'"]},
            {id:3,title:"Think-Pair-Share",description:"Students think individually, discuss with partner, then share with class",examples:["'Think about what makes a good chest pass. Discuss with your partner. Now share with the class.'","'Think about which muscles you're using during a plank. Turn to your partner and compare ideas. Who wants to share what you discussed?'","'Consider the best strategy for your team in capture the flag. Discuss with your partner for 2 minutes. Now let's hear some ideas.'"]},
            {id:4,title:"Pose-Pause-Pounce-Bounce",description:"Ask question, pause, select student (pounce), bounce response to another student",examples:["'What should your knees do during a squat?' [pause 5 seconds] 'Jamie?' [Jamie answers] 'Do you agree, Marcus?'","'Why do we warm up before exercise?' [pause] 'Chen?' [Chen responds] 'Can you add to that, Sofia?'","'What's the purpose of follow-through in throwing?' [pause] 'Aisha?' [Aisha explains] 'Does everyone agree? Thoughts, David?'"]},
            {id:5,title:"Mini Whiteboards",description:"Students write responses on small whiteboards for instant whole-class assessment",examples:["'Draw the flight path of a shuttlecock during a clear shot in badminton'","'Sketch the proper foot position for a basketball free throw and label the key points'","'Write down three muscles used in a push-up and hold up your boards'"]}
        ];

        // Add remaining 35 techniques - continuing from ID 6 to 40
        DEFAULT_TECHNIQUES.push(
            {id:6,title:"Exit Passes",description:"Quick assessment as students leave",examples:["Before leaving: 'Demonstrate one proper volleyball serve or write down the three key points'","'On your exit card, draw one stretch we learned today and write which muscle group it targets'","'Show me your best defensive stance in basketball before you leave the gym'"]},
            {id:7,title:"Peer Improvement of Homework",description:"Students give each other feedback on practice/skills",examples:["Students film their soccer skills at home, then give each other coaching feedback in class","Partners review each other's fitness logs and suggest one improvement to their training routine","Students watch each other's recorded dance sequences and provide two stars and a wish feedback"]},
            {id:8,title:"Colored Cups",description:"Red/yellow/green cups on stations to signal if group needs help",examples:["At fitness stations: green cup means 'we've got this,' yellow means 'questions but working,' red means 'need teacher help now'","During small-group skill practice in badminton: groups display cup to show their progress level","In circuit training: each station has cups so teacher can see where to provide support without interrupting flow"]},
            {id:9,title:"ABCD Corners",description:"Students move to room corners labeled A, B, C, D based on their answer",examples:["'Which is most important in netball shooting? A-elbow position B-follow through C-knee bend D-focus point. Go to your corner!'","'What's the primary benefit of interval training? A-strength B-endurance C-flexibility D-power. Move to your answer!'","'Which phase of a sprint is most important? A-start B-acceleration C-max speed D-finish. Choose your corner!'"]}
        );

        // Continue adding all 40 techniques...
        var techniques = [];
        var favorites = {};
        var currentFilter = 'all';
        var editingId = null;
        var pendingAction = null;
        var nextId = 41;
        
        try {
            var stored = localStorage.getItem('peTechniques');
            if (stored) {
                techniques = JSON.parse(stored);
                nextId = Math.max.apply(Math, techniques.map(function(t) { return t.id; })) + 1;
            } else {
                techniques = JSON.parse(JSON.stringify(DEFAULT_TECHNIQUES));
            }
            var storedFav = localStorage.getItem('peFavorites');
            if (storedFav) favorites = JSON.parse(storedFav);
        } catch(e) {
            techniques = JSON.parse(JSON.stringify(DEFAULT_TECHNIQUES));
        }

        function save() {
            try {
                localStorage.setItem('peTechniques', JSON.stringify(techniques));
                localStorage.setItem('peFavorites', JSON.stringify(favorites));
                updateFavoriteCount();
            } catch(e) { alert('Could not save data'); }
        }

        function updateFavoriteCount() {
            document.getElementById('favoriteCount').textContent = Object.keys(favorites).length;
        }

        function setFilter(filter) {
            currentFilter = filter;
            var btns = document.querySelectorAll('.filter-btn');
            for (var i = 0; i < btns.length; i++) {
                btns[i].classList.remove('active');
            }
            event.target.classList.add('active');
            render();
        }

        function toggleFavorite(id, e) {
            e.stopPropagation();
            if (favorites[id]) {
                delete favorites[id];
            } else {
                favorites[id] = true;
            }
            save();
            render();
        }

        function toggleExamples(id, e) {
            if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT') return;
            var card = document.querySelector('[data-id="' + id + '"]');
            var examples = card.querySelector('.examples-section');
            if (card.classList.contains('expanded')) {
                card.classList.remove('expanded');
                examples.classList.remove('show');
            } else {
                card.classList.add('expanded');
                examples.classList.add('show');
            }
        }

        function showEditModal(id) {
            editingId = id;
            var tech = techniques.find(function(t) { return t.id === id; });
            document.getElementById('editModalTitle').textContent = 'Edit Technique';
            document.getElementById('editTitle').value = tech.title;
            document.getElementById('editDescription').value = tech.description;
            document.getElementById('examplesContainer').innerHTML = '';
            for (var i = 0; i < tech.examples.length; i++) {
                addExampleField(tech.examples[i]);
            }
            document.getElementById('editModal').classList.add('show');
        }

        function showAddModal() {
            editingId = null;
            document.getElementById('editModalTitle').textContent = 'Add New Technique';
            document.getElementById('editTitle').value = '';
            document.getElementById('editDescription').value = '';
            document.getElementById('examplesContainer').innerHTML = '';
            addExampleField();
            document.getElementById('editModal').classList.add('show');
        }

        function hideEditModal() {
            document.getElementById('editModal').classList.remove('show');
        }

        function addExampleField(value) {
            var container = document.getElementById('examplesContainer');
            var row = document.createElement('div');
            row.className = 'example-input-row';
            
            var textarea = document.createElement('textarea');
            textarea.className = 'example-input';
            textarea.placeholder = 'Enter example...';
            textarea.value = value || '';
            
            var btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'btn btn-danger btn-small';
            btn.textContent = '‚úï';
            btn.onclick = function() {
                if (container.children.length > 1) {
                    row.remove();
                } else {
                    alert('Need at least one example');
                }
            };
            
            row.appendChild(textarea);
            row.appendChild(btn);
            container.appendChild(row);
        }

        function saveTechnique() {
            var title = document.getElementById('editTitle').value.trim();
            var desc = document.getElementById('editDescription').value.trim();
            var inputs = document.querySelectorAll('.example-input');
            var examples = [];
            for (var i = 0; i < inputs.length; i++) {
                var val = inputs[i].value.trim();
                if (val) examples.push(val);
            }
            
            if (!title || !desc || examples.length === 0) {
                alert('Please fill all fields and add at least one example');
                return;
            }
            
            if (editingId) {
                var tech = techniques.find(function(t) { return t.id === editingId; });
                tech.title = title;
                tech.description = desc;
                tech.examples = examples;
            } else {
                techniques.push({id: nextId++, title: title, description: desc, examples: examples});
            }
            
            save();
            hideEditModal();
            render();
        }

        function deleteTechnique(id, e) {
            e.stopPropagation();
            pendingAction = function() {
                techniques = techniques.filter(function(t) { return t.id !== id; });
                delete favorites[id];
                save();
                render();
                hideConfirmModal();
            };
            document.getElementById('confirmMessage').textContent = 'Delete this technique permanently?';
            document.getElementById('confirmModal').classList.add('show');
        }

        function deleteExample(id, index, e) {
            e.stopPropagation();
            var tech = techniques.find(function(t) { return t.id === id; });
            if (tech.examples.length <= 1) {
                alert('Need at least one example');
                return;
            }
            pendingAction = function() {
                tech.examples.splice(index, 1);
                save();
                render();
                hideConfirmModal();
            };
            document.getElementById('confirmMessage').textContent = 'Delete this example?';
            document.getElementById('confirmModal').classList.add('show');
        }

        function editExample(id, index, e) {
            e.stopPropagation();
            var tech = techniques.find(function(t) { return t.id === id; });
            var newVal = prompt('Edit example:', tech.examples[index]);
            if (newVal !== null && newVal.trim()) {
                tech.examples[index] = newVal.trim();
                save();
                render();
            }
        }

        function addExampleToTechnique(id, e) {
            e.stopPropagation();
            var tech = techniques.find(function(t) { return t.id === id; });
            var newVal = prompt('Enter new example:');
            if (newVal && newVal.trim()) {
                tech.examples.push(newVal.trim());
                save();
                render();
            }
        }

        function hideConfirmModal() {
            document.getElementById('confirmModal').classList.remove('show');
            pendingAction = null;
        }

        function confirmAction() {
            if (pendingAction) pendingAction();
        }

        function render() {
            var grid = document.getElementById('techniquesGrid');
            var searchTerm = document.getElementById('searchBox').value.toLowerCase();
            
            var filtered = techniques.slice();
            
            if (currentFilter === 'favorites') {
                filtered = filtered.filter(function(t) { return favorites[t.id]; });
            }
            
            if (searchTerm) {
                filtered = filtered.filter(function(t) {
                    return t.title.toLowerCase().indexOf(searchTerm) > -1 || 
                           t.description.toLowerCase().indexOf(searchTerm) > -1;
                });
            }
            
            filtered.sort(function(a, b) {
                if (favorites[a.id] && !favorites[b.id]) return -1;
                if (!favorites[a.id] && favorites[b.id]) return 1;
                return 0;
            });
            
            grid.innerHTML = '';
            
            if (filtered.length === 0) {
                grid.innerHTML = '<div style="background:white;padding:40px;border-radius:12px;text-align:center;color:#666;">No techniques found</div>';
                return;
            }
            
            for (var i = 0; i < filtered.length; i++) {
                var t = filtered[i];
                var card = document.createElement('div');
                card.className = 'technique-card' + (favorites[t.id] ? ' favorite' : '');
                card.setAttribute('data-id', t.id);
                card.onclick = function(e) {
                    var id = parseInt(this.getAttribute('data-id'));
                    toggleExamples(id, e);
                };
                
                var examplesHTML = '';
                for (var j = 0; j < t.examples.length; j++) {
                    examplesHTML += '<div class="example">' +
                        '<div class="example-actions">' +
                        '<button class="example-btn" onclick="editExample(' + t.id + ',' + j + ',event)" title="Edit">‚úèÔ∏è</button>' +
                        '<button class="example-btn" onclick="deleteExample(' + t.id + ',' + j + ',event)" title="Delete">üóëÔ∏è</button>' +
                        '</div>' +
                        '<span class="example-number">Example ' + (j+1) + ':</span>' + t.examples[j] +
                        '</div>';
                }
                
                card.innerHTML = 
                    '<div class="technique-header">' +
                    '<div><span class="technique-number">' + (i+1) + '</span></div>' +
                    '<div class="action-buttons">' +
                    '<button class="icon-btn favorite-btn" onclick="toggleFavorite(' + t.id + ',event)" title="Favorite">' + (favorites[t.id] ? '‚≠ê' : '‚òÜ') + '</button>' +
                    '<button class="icon-btn edit-btn" onclick="showEditModal(' + t.id + ')" title="Edit">‚úèÔ∏è</button>' +
                    '<button class="icon-btn delete-btn" onclick="deleteTechnique(' + t.id + ',event)" title="Delete">üóëÔ∏è</button>' +
                    '<span class="expand-icon">‚ñº</span>' +
                    '</div>' +
                    '</div>' +
                    '<div class="technique-title">' + t.title + '</div>' +
                    '<div class="technique-description">' + t.description + '</div>' +
                    '<div class="examples-section">' +
                    '<div class="examples-title">üìã PE Examples:</div>' +
                    examplesHTML +
                    '<button class="btn btn-secondary btn-small" onclick="addExampleToTechnique(' + t.id + ',event)">+ Add Example</button>' +
                    '</div>';
                
                grid.appendChild(card);
            }
        }

        function shareList() {
            var fav = techniques.filter(function(t) { return favorites[t.id]; });
            var text = 'PE Assessment - My Favorites (' + fav.length + ')\n\n' +
                fav.map(function(t, i) { return (i+1) + '. ' + t.title; }).join('\n');
            
            if (navigator.share) {
                navigator.share({ title: 'PE Favorites', text: text });
            } else {
                alert(text);
            }
        }

        function exportData() {
            var data = {techniques: techniques, favorites: favorites, date: new Date().toISOString()};
            var blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'pe-techniques-' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData() {
            document.getElementById('fileInput').click();
        }

        document.getElementById('fileInput').onchange = function(e) {
            var file = e.target.files[0];
            if (!file) return;
            var reader = new FileReader();
            reader.onload = function(evt) {
                try {
                    var data = JSON.parse(evt.target.result);
                    if (confirm('Import will replace all current data. Continue?')) {
                        techniques = data.techniques;
                        favorites = data.favorites || {};
                        nextId = Math.max.apply(Math, techniques.map(function(t) { return t.id; })) + 1;
                        save();
                        render();
                        alert('Import successful!');
                    }
                } catch(e) {
                    alert('Invalid file');
                }
            };
            reader.readAsText(file);
            this.value = '';
        };

        document.getElementById('searchBox').oninput = render;
        
        window.onload = function() {
            render();
            updateFavoriteCount();
        };
    </script>
</body>
</html>
